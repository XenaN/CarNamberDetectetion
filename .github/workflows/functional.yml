name: Functional

on:
  push:
    branches:
    - main
  pull_request: {}


jobs:
  test:
    strategy:
      fail-fast: true
      matrix:
        os: [ubuntu-latest]
        python-version: [ "3.8" ]
    runs-on: ${{ matrix.os }}
    steps:
      #----------------------------------------------
      #       check-out repo and set-up python
      #----------------------------------------------
      - name: Check out repository and submodules
        uses: actions/checkout@v2
        with:
            submodules: recursive

      - name: Set up python ${{ matrix.python-version }}
        id: setup-python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}
          cache: 'pip'

      - uses: iterative/setup-dvc@v1

      - name: Run env-setup
        run: ./env-setup.sh

      - name: Upload logs
        uses: actions/upload-artifact@v2
        with:
            name: env-setup-log
            path: log.txt
            retention-days: 1

      - name: Run functional tests
        run: |
          dvc repro -s create_annotations
          dvc repro -s create_test_dataset
          dvc repro -s create_list_files
          dvc repro -s create_config
